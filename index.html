<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BeBetter ¬∑ –¢—Ä–µ–∫–µ—Ä</title>

  <!-- Telegram WebApp -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <!-- –ü—Ä–µ–ª–æ–∞–¥ hero –¥–ª—è 1-–≥–æ —ç–∫—Ä–∞–Ω–∞ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞ -->
  <link rel="preload" as="image" href="assets/onb-1.avif" imagesrcset="assets/onb-1.avif 1x, assets/onb-1.webp 1x, assets/onb-1.png 1x" />

  <style>
    :root{
      --text:#ffffff;
      --muted:#C7E2FF;

      --bg1:#0F5CC0; --bg2:#0049A8; --bg3:#003C99; --bg4:#003080;
      --card:#0b3a7a;

      --accent:#19E0FF; --accent-2:#7AE7FF;

      --body:#2dd4bf; --mind:#60a5fa; --meaning:#a78bfa;
      --empty:#275aaa;

      /* –ø—Ä–∏—è—Ç–Ω—ã–π —Å–∏–Ω–∏–π –¥–ª—è –æ–±–≤–æ–¥–æ–∫ */
      --edge:#2B6FF6;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--text);
      background:linear-gradient(180deg,var(--bg1) 0%, var(--bg2) 35%, var(--bg3) 60%, var(--bg4) 100%);
    }
    .wrap{max-width:900px;margin:0 auto;padding:16px 14px 120px}

    /* ===== –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å ===== */
    .topbar{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:10px}
    .hello{display:flex;align-items:center;gap:10px;font-weight:600;font-size:16px}
    .hello .avatar{
      width:34px;height:34px;border-radius:999px;
      background:linear-gradient(135deg,#1b4f9e,#0f3c81);display:grid;place-items:center;
      font-weight:800;color:#E7F3FF
    }
    .streak{
      display:flex;align-items:center;gap:8px;
      background:linear-gradient(#0f3f87,#0c3270);
      border:1px solid rgba(255,255,255,.22);
      border-radius:14px;padding:8px 12px;
      color:#ffd166;font-weight:800;min-width:72px;justify-content:center
    }
    .sep{height:1px;background:linear-gradient(90deg,transparent, rgba(255,255,255,.25), transparent);margin:12px 0}

    /* ===== –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å ===== */
    .days{
      display:flex;gap:10px;overflow-x:auto;overflow-y:visible;
      padding:8px 0; scroll-snap-type:x proximity
    }
    .day{
      flex:0 0 auto;scroll-snap-align:center;width:64px;border-radius:16px;padding:10px 8px;
      text-align:center;cursor:pointer;user-select:none;transition:transform .12s ease;
      background:var(--card);border:1px solid rgba(255,255,255,.18)
    }
    .day:hover{transform:translateY(-2px)}
    .day.selected{
      background:
        linear-gradient(180deg, rgba(25,224,255,.15), rgba(122,231,255,.08)) padding-box,
        linear-gradient(60deg, var(--body), var(--mind), var(--meaning)) border-box;
      border:1px solid transparent;
      box-shadow:0 0 16px rgba(122,231,255,.25);
    }
    .day .dow{font-size:11px;color:var(--muted);letter-spacing:.06em;text-transform:uppercase}
    .day .num{font-size:20px;font-weight:900;line-height:1.1;margin:4px 0 6px;color:#fff}

    /* ===== –ö–æ–ª—å—Ü–æ-—Å–µ–∫—Ç–æ—Ä—ã (–∞–∫–∫—É—Ä–∞—Ç–Ω—ã–π –∫–æ–Ω—Ç—É—Ä) ===== */
    .ring{
      --seg1: var(--empty);
      --seg2: var(--empty);
      --seg3: var(--empty);
      position:relative;
      width:38px;height:38px;margin:0 auto;border-radius:50%;
    }
    .ring::before{
      content:"";
      position:absolute; inset:0; border-radius:50%;
      background: conic-gradient(from 90deg, var(--seg1) 0 120deg, var(--seg2) 120deg 240deg, var(--seg3) 240deg 360deg);
      -webkit-mask: radial-gradient(farthest-side, transparent calc(100% - 6px), #000 calc(100% - 6px));
              mask: radial-gradient(farthest-side, transparent calc(100% - 6px), #000 calc(100% - 6px));
    }
    .ring::after{
      content:"";
      position:absolute; inset:0; border-radius:50%;
      box-shadow: inset 0 0 0 2px rgba(255,255,255,.18);
    }

    /* ===== –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä—ã —Å—Ñ–µ—Ä ===== */
    .spheres{display:grid;grid-template-columns:1fr;gap:12px;margin:12px 0 10px}
    @media (min-width:740px){ .spheres{grid-template-columns:1fr 1fr 1fr} }
    .sphere{
      background:linear-gradient(180deg,#0f3f87,#0c3270);
      border:1px solid rgba(255,255,255,.18);border-radius:16px;padding:12px
    }
    .sphere .row{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
    .tag{display:inline-flex;align-items:center;gap:8px;font-weight:800}
    .tag .dot{width:10px;height:10px;border-radius:999px}
    .meter{
      height:14px;border-radius:999px;background:rgba(255,255,255,.12);
      border:1px solid rgba(255,255,255,.2);overflow:hidden;position:relative
    }
    .fill{height:100%;width:0%;transition: width .35s ease-out;}
    .sphere[data-s="body"] .fill{ background:linear-gradient(90deg, var(--body), #5ff4e3); }
    .sphere[data-s="mind"] .fill{ background:linear-gradient(90deg, var(--mind), #a5d8ff); }
    .sphere[data-s="meaning"] .fill{ background:linear-gradient(90deg, var(--meaning), #d8c9ff); }
    .pct{font-variant-numeric:tabular-nums;color:#fff;font-weight:800}

    /* ===== –ü–æ–¥–ø–∏—Å—å –¥–Ω—è + info ===== */
    .daytitle{display:flex;align-items:center;justify-content:space-between;margin:6px 0 6px}
    .daytitle .label{font-weight:900;font-size:18px;color:#fff}
    .icon-btn{
      width:36px;height:36px;border-radius:999px;
      background:linear-gradient(#0f3f87,#0c3270);
      border:1px solid var(--edge);
      display:grid;place-items:center;cursor:pointer;transition:transform .12s ease;
      color:#fff; font-weight:900;
    }
    .icon-btn:hover{transform:translateY(-1px)}

    /* ===== –í–≤–æ–¥ –ø–æ–±–µ–¥ ===== */
    .inputs{display:grid;grid-template-columns:1fr;gap:12px;margin-top:10px}
    @media (min-width:740px){ .inputs{grid-template-columns:1fr 1fr 1fr} }
    .input-card{
      background:linear-gradient(180deg,#0f3f87,#0c3270);
      border:1px solid rgba(255,255,255,.18);border-radius:16px;padding:12px;display:flex;flex-direction:column;gap:8px
    }
    .input-card .hdr{display:flex;align-items:center;gap:8px;font-weight:800;color:#fff}
    .input{display:flex;gap:8px;align-items:center}
    input[type="text"]{
      flex:1;padding:12px 12px;border-radius:12px;border:1px solid #1A5ED1;background:#08356E;color:#fff;outline:none;font-size:14px
    }
    input::placeholder{color:#9CCAFF}

    /* –ö–Ω–æ–ø–∫–∞-–≥–∞–ª–æ—á–∫–∞: —Å–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π —Ñ–æ–Ω + –≤—Å–ø—ã—à–∫–∞ —Ü–≤–µ—Ç–æ–º —Å—Ñ–µ—Ä—ã */
    .submit{
      width:44px;height:44px;border-radius:12px;
      background:#E6EDF9;                 /* –±–∞–∑–æ–≤—ã–π —Å–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π */
      border:1px solid var(--edge);
      display:grid;place-items:center;cursor:pointer;
      font-size:18px;color:#fff;font-weight:900;   /* –≥–∞–ª–∫–∞ –±–µ–ª–∞—è */
      transition: background-color .2s ease;
    }
    .submit.flash.s-body{   background: var(--body);   }
    .submit.flash.s-mind{   background: var(--mind);   }
    .submit.flash.s-meaning{background: var(--meaning);}

    .small{font-size:12px;color:var(--muted)}

    /* ===== –°–ø–∏—Å–æ–∫ –ø–æ–±–µ–¥ ===== */
    .list{margin-top:12px; display:grid; gap:8px}
    .item{
      background:linear-gradient(180deg,#0f3f87,#0c3270);
      border:1px solid rgba(255,255,255,.18);border-radius:14px;padding:10px;
      display:flex;align-items:center;justify-content:space-between;gap:10px
    }
    .item .left{display:flex;align-items:flex-start;gap:8px}
    .pill{font-size:12px;padding:4px 8px;border-radius:999px;border:1px solid rgba(255,255,255,.25);background:rgba(255,255,255,.12);color:#fff}
    .actions{display:flex;gap:6px}
    .btn{
      height:32px;min-width:32px;border-radius:10px;
      background:linear-gradient(#0f3f87,#0c3270);
      border:1px solid var(--edge);
      display:grid;place-items:center;cursor:pointer;color:#fff;font-weight:800
    }

    /* ===== –ú–æ–¥–∞–ª–∫–∞ ===== */
    .modal{position:fixed;inset:0;background:rgba(5,10,20,.55);display:none;align-items:center;justify-content:center;padding:16px;z-index:20}
    .modal.show{display:flex}
    .sheet{
      width:min(880px,96vw);max-height:86vh;overflow:auto;background:#0f3f87;border:1px solid rgba(255,255,255,.18);border-radius:18px;padding:14px 14px 16px;color:#fff
    }
    .sheet h3{margin:6px 0 12px}
    .grid{display:grid;gap:10px}
    @media (min-width:740px){ .grid{grid-template-columns:1fr 1fr 1fr} }
    .card{background:#0c3270;border:1px solid rgba(255,255,255,.18);border-radius:14px;padding:10px}
    .card .title{display:flex;align-items:center;gap:8px;font-weight:900;margin-bottom:6px}
    .modal .close{position:sticky;top:0;margin-left:auto;margin-bottom:8px}

    .onb-open-wrap{display:flex;justify-content:flex-end;margin-top:10px}
    .btn-mini{height:40px;border-radius:12px;font-weight:900;cursor:pointer;color:#00275f;
      background:linear-gradient(#7AE7FF,#19E0FF); border:1px solid var(--edge); padding:0 14px;
    }

    .days::-webkit-scrollbar{height:8px}
    .days::-webkit-scrollbar-thumb{background:rgba(255,255,255,.25);border-radius:8px}

    /* ===== –û–Ω–±–æ—Ä–¥–∏–Ω–≥ (full-screen overlay) ===== */
    .onb{
      position:fixed; inset:0; z-index:50; display:none;
      background:linear-gradient(180deg,rgba(8,24,64,.85), rgba(8,24,64,.95));
      backdrop-filter: blur(6px);
      color:#fff;
    }
    .onb.show{ display:flex; align-items:center; justify-content:center; padding:18px; }
    .onb-card{
      width:min(860px,96vw); height:min(92vh,860px);
      background:linear-gradient(180deg,#0f3f87,#0c3270);
      border:1px solid rgba(255,255,255,.22); border-radius:22px;
      display:flex; flex-direction:column; overflow:hidden;
    }
    .onb-top{ display:flex; align-items:center; justify-content:space-between; padding:14px 16px; }
    .onb-dots{ display:flex; gap:8px; align-items:center; }
    .dot{ width:8px; height:8px; border-radius:999px; background:rgba(255,255,255,.35); }
    .dot.active{ background:#fff; box-shadow:0 0 0 3px rgba(255,255,255,.18) }
    .onb-skip{ background:none; border:0; color:#fff; font-weight:800; cursor:pointer; opacity:.9 }
    .onb-body{ flex:1; display:flex; flex-direction:column; align-items:center; justify-content:flex-start; overflow:auto; padding:12px 18px 0; width:100% }
    .onb-hero{ display:flex; align-items:center; justify-content:center; width:100%; height:34%; min-height:160px; }
    /* —Ñ–∏–∫—Å –ø–æ–∑–∏—Ü–∏–∏ –∏ —Ä–∞–∑–º–µ—Ä–æ–≤ –∫–∞—Ä—Ç–∏–Ω–∫–∏ */
    .hero-picture{ display:block; width:min(65%, 420px); margin:0 auto; }
    .hero-img{ display:block; width:100%; height:auto; object-fit:contain; contain:content; }
    @media (max-width:380px){
      .hero-picture{ width:min(70%, 360px); }
      .onb-hero{ height:30%; min-height:140px; }
    }
    .onb-h1{ font-size:24px; font-weight:900; margin:8px 0 6px; text-align:center }
    .onb-p{ font-size:14px; color:#E6F2FF; text-align:center; max-width:720px; margin:0 auto 8px }
    .onb-list{ display:grid; gap:6px; max-width:760px; margin:8px auto 8px; padding:0 8px; font-size:14px }
    .onb-hint{ color:#C7E2FF; opacity:.9; font-size:12px; text-align:center; margin-top:4px }
    .onb-cta{ padding:12px 16px; display:grid; gap:8px }
    .btn-primary{
      height:48px; border-radius:14px; font-weight:900; cursor:pointer; color:#00275f;
      background:linear-gradient(#7AE7FF,#19E0FF); border:1px solid var(--edge);
    }
    .btn-ghost{
      height:44px; border-radius:14px; font-weight:800; cursor:pointer; color:#fff;
      background:transparent; border:1px dashed rgba(255,255,255,.35)
    }
    .swipe{ touch-action:pan-y; }
  </style>
</head>
<body>
  <div class="wrap">
    <!-- 1. –í–µ—Ä—Ö -->
    <div class="topbar">
      <div class="hello">
        <div class="avatar">BB</div>
        <div id="hello">–ü—Ä–∏–≤–µ—Ç!</div>
      </div>
      <div class="streak" title="–°–µ—Ä–∏—è –¥–Ω–µ–π —Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é">
        <span class="ico">üî•</span><span id="streak">0</span>
      </div>
    </div>
    <div class="sep"></div>

    <!-- 2. –ö–∞–ª–µ–Ω–¥–∞—Ä—å -->
    <div id="days" class="days" aria-label="–õ–µ–Ω—Ç–∞ –¥–Ω–µ–π"></div>

    <!-- 3. –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä—ã -->
    <div class="spheres">
      <div class="sphere" data-s="body">
        <div class="row">
          <div class="tag"><span class="dot" style="background:var(--body)"></span>–¢–µ–ª–æ –∏ —ç–Ω–µ—Ä–≥–∏—è</div>
          <div class="pct" id="pct-body">0/100</div>
        </div>
        <div class="meter"><div class="fill" id="bar-body"></div></div>
      </div>
      <div class="sphere" data-s="mind">
        <div class="row">
          <div class="tag"><span class="dot" style="background:var(--mind)"></span>–£–º –∏ —Ñ–æ–∫—É—Å</div>
          <div class="pct" id="pct-mind">0/100</div>
        </div>
        <div class="meter"><div class="fill" id="bar-mind"></div></div>
      </div>
      <div class="sphere" data-s="meaning">
        <div class="row">
          <div class="tag"><span class="dot" style="background:var(--meaning)"></span>–°–º—ã—Å–ª –∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ</div>
          <div class="pct" id="pct-meaning">0/100</div>
        </div>
        <div class="meter"><div class="fill" id="bar-meaning"></div></div>
      </div>
    </div>

    <!-- 4. –ü–æ–¥–ø–∏—Å—å –¥–Ω—è + info -->
    <div class="daytitle">
      <div class="label" id="dayLabel">–°–µ–≥–æ–¥–Ω—è</div>
      <button class="icon-btn" id="infoBtn" title="–ß—Ç–æ –æ–∑–Ω–∞—á–∞—é—Ç —Å—Ñ–µ—Ä—ã?"><b>i</b></button>
    </div>

    <!-- 5. –í–≤–æ–¥ –ø–æ–±–µ–¥ -->
    <div class="inputs">
      <div class="input-card" data-s="body">
        <div class="hdr"><span class="dot" style="background:var(--body)"></span>–¢–µ–ª–æ –∏ —ç–Ω–µ—Ä–≥–∏—è</div>
        <div class="input">
          <input id="inp-body" type="text" placeholder="–ù–∞–ø—Ä.: 30 –º–∏–Ω —Ö–æ–¥—å–±—ã ¬∑ –∑–∞—Ä—è–¥–∫–∞" />
          <button class="submit" id="btn-body" title="–î–æ–±–∞–≤–∏—Ç—å –ø–æ–±–µ–¥—É">‚úî</button>
        </div>
        <div class="small">1-—è –ø–æ–±–µ–¥–∞ –¥–Ω—è: +3, –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ —Å–µ–≥–æ–¥–Ω—è: +1</div>
      </div>

      <div class="input-card" data-s="mind">
        <div class="hdr"><span class="dot" style="background:var(--mind)"></span>–£–º –∏ —Ñ–æ–∫—É—Å</div>
        <div class="input">
          <input id="inp-mind" type="text" placeholder="–ù–∞–ø—Ä.: 2 —Ñ–æ–∫—É—Å-—Å–µ—Ç–∞ ¬∑ –∑–∞–º–µ—Ç–∫–∞ CBT" />
          <button class="submit" id="btn-mind" title="–î–æ–±–∞–≤–∏—Ç—å –ø–æ–±–µ–¥—É">‚úî</button>
        </div>
        <div class="small">1-—è –ø–æ–±–µ–¥–∞ –¥–Ω—è: +3, –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ —Å–µ–≥–æ–¥–Ω—è: +1</div>
      </div>

      <div class="input-card" data-s="meaning">
        <div class="hdr"><span class="dot" style="background:var(--meaning)"></span>–°–º—ã—Å–ª –∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ</div>
        <div class="input">
          <input id="inp-meaning" type="text" placeholder="–ù–∞–ø—Ä.: 10 –º–∏–Ω –º–µ–¥–∏—Ç–∞—Ü–∏–∏ ¬∑ –∞–∫—Ç —Ü–µ–Ω–Ω–æ—Å—Ç–∏" />
          <button class="submit" id="btn-meaning" title="–î–æ–±–∞–≤–∏—Ç—å –ø–æ–±–µ–¥—É">‚úî</button>
        </div>
        <div class="small">1-—è –ø–æ–±–µ–¥–∞ –¥–Ω—è: +3, –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ —Å–µ–≥–æ–¥–Ω—è: +1</div>
      </div>
    </div>

    <!-- –°–ø–∏—Å–æ–∫ –ø–æ–±–µ–¥ -->
    <div id="list" class="list"></div>
    <div id="empty" class="empty" style="display:none">–ü–æ–∫–∞ –Ω–µ—Ç –ø–æ–±–µ–¥ –∑–∞ —ç—Ç–æ—Ç –¥–µ–Ω—å ‚Äî —Å–∞–º–æ–µ –≤—Ä–µ–º—è –Ω–∞—á–∞—Ç—å üí™</div>
  </div>

  <!-- ===== –ò–Ω—Ñ–æ-–º–æ–¥–∞–ª–∫–∞ ===== -->
  <div class="modal" id="modal">
    <div class="sheet">
      <button class="icon-btn close" id="closeModal">‚úï</button>
      <h3>–¢—Ä–∏ —Å—Ñ–µ—Ä—ã —Ä–∞–∑–≤–∏—Ç–∏—è</h3>
      <div class="grid">
        <div class="card">
          <div class="title"><span class="dot" style="background:var(--body)"></span>–¢–µ–ª–æ –∏ —ç–Ω–µ—Ä–≥–∏—è</div>
          <div class="small">
            <b>–û–ø–∏—Å–∞–Ω–∏–µ.</b> –ë–∞–∑–∞ –∂–∏–∑–Ω–µ–Ω–Ω–æ–π —Å–∏–ª—ã: –¥–≤–∏–∂–µ–Ω–∏–µ, —Å–æ–Ω, –ø–∏—Ç–∞–Ω–∏–µ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ.<br/>
            <b>–≠—Ñ—Ñ–µ–∫—Ç.</b> –ë–æ–ª—å—à–µ —ç–Ω–µ—Ä–≥–∏–∏ –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ; –º–µ–Ω—å—à–µ —Å—Ç—Ä–µ—Å—Å–∞; –ª—É—á—à–µ —Ñ–æ—Ä–º–∞ –∏ –∑–¥–æ—Ä–æ–≤—å–µ.<br/>
            <b>–ß—Ç–æ –¥–µ–ª–∞—Ç—å.</b> 7‚Äì10 —Ç—ã—Å. —à–∞–≥–æ–≤/–¥–µ–Ω—å; 150 –º–∏–Ω –∫–∞—Ä–¥–∏–æ/–Ω–µ–¥ + —Å–∏–ª–æ–≤—ã–µ 2√ó; —Å–æ–Ω 7‚Äì9 —á; –±–µ–ª–æ–∫ –∏ –æ–≤–æ—â–∏ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å.
          </div>
        </div>
        <div class="card">
          <div class="title"><span class="dot" style="background:var(--mind)"></span>–£–º –∏ —Ñ–æ–∫—É—Å</div>
          <div class="small">
            <b>–û–ø–∏—Å–∞–Ω–∏–µ.</b> –ù–∞–≤—ã–∫–∏ –≤–Ω–∏–º–∞–Ω–∏—è –∏ –º—ã—à–ª–µ–Ω–∏—è: –∫–∞–∫ –≤—ã–±–∏—Ä–∞–µ—à—å —Ñ–æ–∫—É—Å, –≥–æ–≤–æ—Ä–∏—à—å —Å —Å–æ–±–æ–π, —É—á–∏—à—å—Å—è –∏ –ø—Ä–∏–Ω–∏–º–∞–µ—à—å —Ä–µ—à–µ–Ω–∏—è.<br/>
            <b>–≠—Ñ—Ñ–µ–∫—Ç.</b> –ú–µ–Ω—å—à–µ —Ç—Ä–µ–≤–æ–≥–∏ –∏ ¬´—à—É–º–∞¬ª; –±–æ–ª—å—à–µ —è—Å–Ω–æ—Å—Ç–∏ –∏ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã; –±—ã—Å—Ç—Ä–µ–µ —É—á–∏—à—å—Å—è –∏ –¥–æ–≤–æ–¥–∏—à—å –¥–µ–ª–∞.<br/>
            <b>–ß—Ç–æ –¥–µ–ª–∞—Ç—å.</b> –§–æ–∫—É—Å-—Å–µ—Ç—ã 25‚Äì50 –º–∏–Ω; –¥–Ω–µ–≤–Ω–∏–∫ –º—ã—Å–ª–µ–π (CBT) 1 –∑–∞–ø–∏—Å—å/–¥–µ–Ω—å; 3 –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏; —É—á—ë–±–∞ 30‚Äì60 –º–∏–Ω —Å —Å–∞–º–æ—Ç–µ—Å—Ç–æ–º.
          </div>
        </div>
        <div class="card">
          <div class="title"><span class="dot" style="background:var(--meaning)"></span>–°–º—ã—Å–ª –∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ</div>
          <div class="small">
            <b>–û–ø–∏—Å–∞–Ω–∏–µ.</b> –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ–ø–æ—Ä–∞ –Ω–∞ —Ü–µ–Ω–Ω–æ—Å—Ç–∏, –ø—Ä–∏–Ω—è—Ç–∏–µ –ø–µ—Ä–µ–∂–∏–≤–∞–Ω–∏–π –∏ —Å–≤—è–∑—å —Å ¬´–±–æ–ª—å—à–∏–º¬ª.<br/>
            <b>–≠—Ñ—Ñ–µ–∫—Ç.</–±> –ì–ª—É–±–æ–∫–∏–π –ø–æ–∫–æ–π; —Å–æ—Å—Ç—Ä–∞–¥–∞–Ω–∏–µ –∫ —Å–µ–±–µ –∏ –¥—Ä—É–≥–∏–º; —è—Å–Ω–æ–µ ¬´–∑–∞—á–µ–º¬ª.<br/>
            <b>–ß—Ç–æ –¥–µ–ª–∞—Ç—å.</b> –ú–µ–¥–∏—Ç–∞—Ü–∏—è/—Å–æ–∑–µ—Ä—Ü–∞–Ω–∏–µ 5‚Äì15 –º–∏–Ω; –¥—ã—Ö–∞–Ω–∏–µ 6 —Ü/–º–∏–Ω 5‚Äì10 –º–∏–Ω; 1 ¬´–∞–∫—Ç —Ü–µ–Ω–Ω–æ—Å—Ç–∏¬ª/–Ω–µ–¥; —Ä–µ—Ñ–ª–µ–∫—Å–∏–≤–Ω–æ–µ —á—Ç–µ–Ω–∏–µ 10‚Äì20 –º–∏–Ω.
          </div>
        </div>
      </div>

      <!-- –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞ (—ç–∫—Ä–∞–Ω—ã 2‚Äì4) -->
      <div class="onb-open-wrap">
        <button class="btn-mini" id="reopenOnb">–ö—Ä–∞—Ç–∫–∏–π –æ–Ω–±–æ—Ä–¥–∏–Ω–≥</button>
      </div>
    </div>
  </div>

  <!-- ===== –û–Ω–±–æ—Ä–¥–∏–Ω–≥ ===== -->
  <div class="onb" id="onb">
    <div class="onb-card swipe" id="onbCard">
      <div class="onb-top">
        <div class="onb-dots" id="onbDots" aria-label="–ü—Ä–æ–≥—Ä–µ—Å—Å"></div>
        <button class="onb-skip" id="onbSkip" style="display:none;">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å</button>
      </div>
      <div class="onb-body" id="onbBody"></div>
      <div class="onb-cta" id="onbCta"></div>
    </div>
  </div>

<script>
window.addEventListener('DOMContentLoaded', () => {
  const tg = (window.Telegram && window.Telegram.WebApp) ? window.Telegram.WebApp : null;

  function applyTheme() {
    if (!tg) return;
    const p = tg.themeParams || {};
    const css = document.documentElement.style;
    if (p.button_color) css.setProperty('--accent', '#' + p.button_color);
    if (p.button_color) css.setProperty('--accent-2', '#' + p.button_color);
  }
  function setHello() {
    const u = tg?.initDataUnsafe?.user;
    const name = u?.first_name ? u.first_name : '–¥—Ä—É–≥';
    document.getElementById('hello').textContent = `–ü—Ä–∏–≤–µ—Ç, ${name}!`;
    const av = document.querySelector('.avatar');
    av.textContent = (u?.first_name || 'BB').slice(0,2).toUpperCase();
  }

  /* CloudStorage */
  function cloudSupported(){ return !!(tg && tg.CloudStorage); }
  function cloudGetItem(key){ return new Promise((res,rej)=> tg.CloudStorage.getItem(key,(e,v)=> e?rej(e):res(v??''))); }
  function cloudSetItem(key,val){ return new Promise((res,rej)=> tg.CloudStorage.setItem(key,String(val),(e,ok)=> (e||!ok)?rej(e||new Error('setItem failed')):res())); }

  /* Utils */
  const uuid = () => (crypto?.randomUUID) ? crypto.randomUUID() : 'id-'+Date.now().toString(36)+'-'+Math.random().toString(36).slice(2,8);
  const fmtISO = (d)=> new Date(d).toISOString().slice(0,10);
  const todayISO = ()=> fmtISO(new Date());
  const addDays = (iso,dx)=> {
    const dt = new Date(iso);
    dt.setDate(dt.getDate()+dx);
    return fmtISO(dt);
  };
  const diffDays = (a,b)=> Math.round((new Date(a)-new Date(b))/86400000);
  const DOW = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];

  /* State */
  const KEY = 'victory-tracker-v1';
  let state = { items: [], scores:{body:0,mind:0,meaning:0}, createdAt:null };

  async function loadState(){
    if (cloudSupported()){ try{ const raw = await cloudGetItem(KEY); if (raw) return JSON.parse(raw); }catch{} }
    try{ return JSON.parse(localStorage.getItem(KEY)) || state; }catch{ return state; }
  }
  async function saveState(s){
    if (cloudSupported()){ try{ await cloudSetItem(KEY, JSON.stringify(s)); }catch{} }
    try{ localStorage.setItem(KEY, JSON.stringify(s)); }catch{}
  }

  function recomputeScores(){
    const today = todayISO();
    const allDates = state.items.map(i=>i.date);
    const minItemDate = allDates.length ? allDates.reduce((a,b)=> a<b?a:b) : today;
    const startDate = state.createdAt ? (state.createdAt < minItemDate ? state.createdAt : minItemDate) : minItemDate;

    const counts = {};
    state.items.forEach(it=>{
      counts[it.date] = counts[it.date] || {body:0,mind:0,meaning:0};
      counts[it.date][it.sphere] = (counts[it.date][it.sphere]||0) + 1;
    });

    const scores = { body:0, mind:0, meaning:0 };
    let d = startDate;
    while (new Date(d) <= new Date(today)){
      const dayCounts = counts[d] || {body:0,mind:0,meaning:0};
      ['body','mind','meaning'].forEach(s=>{
        const c = dayCounts[s]||0;
        if (c>0){ scores[s] += 3 + (c-1)*1; } else { if (d !== today) scores[s] -= 5; }
        if (scores[s] < 0) scores[s] = 0;
        if (scores[s] > 100) scores[s] = 100;
      });
      d = addDays(d, +1);
    }
    state.scores = scores;
  }

  /* UI refs */
  const daysEl = document.getElementById('days');
  const listEl = document.getElementById('list');
  const emptyEl = document.getElementById('empty');
  const dayLabelEl = document.getElementById('dayLabel');
  const streakEl = document.getElementById('streak');

  const bars = {
    body: document.getElementById('bar-body'),
    mind: document.getElementById('bar-mind'),
    meaning: document.getElementById('bar-meaning'),
  };
  const pcts = {
    body: document.getElementById('pct-body'),
    mind: document.getElementById('pct-mind'),
    meaning: document.getElementById('pct-meaning'),
  };
  const inputs = {
    body: document.getElementById('inp-body'),
    mind: document.getElementById('inp-mind'),
    meaning: document.getElementById('inp-meaning'),
  };
  const buttons = {
    body: document.getElementById('btn-body'),
    mind: document.getElementById('btn-mind'),
    meaning: document.getElementById('btn-meaning'),
  };

  /* Calendar */
  let selectedDate = todayISO();

  function labelForDay(iso){
    const t = todayISO();
    const d = diffDays(iso,t);
    if (d===0) return '–°–µ–≥–æ–¥–Ω—è';
    if (d===-1) return '–í—á–µ—Ä–∞';
    if (d===+1) return '–ó–∞–≤—Ç—Ä–∞';
    const dt = new Date(iso);
    const dd = String(dt.getDate()).padStart(2,'0');
    const mm = String(dt.getMonth()+1).padStart(2,'0');
    return `${dd}.${mm}.${dt.getFullYear()}`;
  }
  function dayHasSphere(iso, sphere){
    return state.items.some(it=> it.date===iso && it.sphere===sphere);
  }
  function renderDays(){
    daysEl.innerHTML = '';
    const start = addDays(todayISO(), -21);
    const end = addDays(todayISO(), +7);
    let cur = start;
    while (new Date(cur) <= new Date(end)){
      const dv = document.createElement('div');
      dv.className = 'day' + (cur===selectedDate ? ' selected' : '');
      dv.dataset.iso = cur;

      const dow = document.createElement('div');
      dow.className = 'dow';
      dow.textContent = DOW[new Date(cur).getDay()];
      const num = document.createElement('div');
      num.className = 'num';
      num.textContent = new Date(cur).getDate();

      const r = document.createElement('div');
      r.className = 'ring';
      r.style.setProperty('--seg1', dayHasSphere(cur,'body') ? 'var(--body)' : 'var(--empty)');
      r.style.setProperty('--seg2', dayHasSphere(cur,'mind') ? 'var(--mind)' : 'var(--empty)');
      r.style.setProperty('--seg3', dayHasSphere(cur,'meaning') ? 'var(--meaning)' : 'var(--empty)');

      dv.appendChild(dow);
      dv.appendChild(num);
      dv.appendChild(r);

      dv.addEventListener('click', ()=>{
        selectedDate = dv.dataset.iso;
        renderDays();
        renderDayTitle();
        renderList();
      });

      daysEl.appendChild(dv);
      cur = addDays(cur, +1);
    }
    const sel = daysEl.querySelector('.day.selected');
    if (sel) sel.scrollIntoView({behavior:'smooth',inline:'center',block:'nearest'});
  }

  function calcStreak(){
    const days = new Set(state.items.map(i=> i.date));
    let d = todayISO();
    if (!days.has(d)) d = addDays(d, -1);
    let cnt = 0;
    while (days.has(d)){ cnt++; d = addDays(d, -1); }
    return cnt;
  }

  function renderBars(){
    ['body','mind','meaning'].forEach(s=>{
      const v = Math.max(0, Math.min(100, Math.round(state.scores[s]||0)));
      bars[s].style.width = v + '%';
      pcts[s].textContent = v + '/100';
    });
  }
  function renderDayTitle(){ dayLabelEl.textContent = labelForDay(selectedDate); }
  function sphereLabel(s){ return s==='body' ? '–¢–µ–ª–æ' : (s==='mind' ? '–£–º' : '–°–º—ã—Å–ª'); }
  function sphereColor(s){ return s==='body' ? 'var(--body)' : (s==='mind' ? 'var(--mind)' : 'var(--meaning)'); }
  function escapeHtml(s){ return String(s).replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

  async function doSaveAndRerender(){
    recomputeScores();
    await saveState(state);
    renderBars(); renderDays(); renderList(); streakEl.textContent = calcStreak();
  }

  function renderList(){
    const items = state.items.filter(i=> i.date===selectedDate).sort((a,b)=> b.ts - a.ts);
    listEl.innerHTML = '';
    if (items.length === 0){ emptyEl.style.display = 'block'; return; }
    emptyEl.style.display = 'none';

    items.forEach(it=>{
      const row = document.createElement('div'); row.className = 'item';
      const left = document.createElement('div'); left.className = 'left';

      const pill = document.createElement('div'); pill.className='pill'; pill.textContent = sphereLabel(it.sphere);
      const text = document.createElement('div');
      text.innerHTML = `<div>${escapeHtml(it.text)}</div><div class="small" style="color:${sphereColor(it.sphere)}">${it.date}</div>`;
      left.appendChild(pill); left.appendChild(text);

      const act = document.createElement('div'); act.className='actions';
      const bEdit = document.createElement('button'); bEdit.className='btn'; bEdit.title='–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å'; bEdit.textContent='‚úé';
      const bDel  = document.createElement('button'); bDel.className='btn';  bDel.title='–£–¥–∞–ª–∏—Ç—å';      bDel.textContent='üóë';

      bEdit.addEventListener('click', async ()=>{
        const nv = prompt('–ò–∑–º–µ–Ω–∏ —Ç–µ–∫—Å—Ç –ø–æ–±–µ–¥—ã:', it.text);
        if (nv && nv.trim()){
          it.text = nv.trim();
          await doSaveAndRerender();
        }
      });
      bDel.addEventListener('click', async ()=>{
        if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –ø–æ–±–µ–¥—É?')){
          state.items = state.items.filter(x=>x.id!==it.id);
          await doSaveAndRerender();
        }
      });

      act.appendChild(bEdit); act.appendChild(bDel);
      row.appendChild(left); row.appendChild(act);
      listEl.appendChild(row);
    });
  }

  /* Info modal */
  const modal = document.getElementById('modal');
  document.getElementById('infoBtn').addEventListener('click', ()=> modal.classList.add('show'));
  document.getElementById('closeModal').addEventListener('click', ()=> modal.classList.remove('show'));
  modal.addEventListener('click', (e)=>{ if (e.target===modal) modal.classList.remove('show'); });
  document.getElementById('reopenOnb').addEventListener('click', ()=>{
    modal.classList.remove('show');
    showOnboarding(2);
  });

  /* –≤—Å–ø—ã—à–∫–∞ —Ü–≤–µ—Ç–∞ —Å—Ñ–µ—Ä—ã —É –∫–Ω–æ–ø–∫–∏-–≥–∞–ª–æ—á–∫–∏ */
  function flashSubmit(s){
    const btn = buttons[s];
    btn.classList.add('flash', `s-${s}`);
    setTimeout(()=> btn.classList.remove('flash', `s-${s}`), 2000);
  }

  /* Inputs */
  function bindInput(s){
    buttons[s].addEventListener('click', async ()=>{
      const t = inputs[s].value.trim();
      if (!t) return;
      state.items.push({ id: uuid(), text: t, sphere: s, date: selectedDate, ts: Date.now() });
      inputs[s].value='';
      flashSubmit(s);
      await doSaveAndRerender();
    });
    inputs[s].addEventListener('keydown', async (e)=>{
      if (e.key==='Enter'){
        e.preventDefault();
        const t = inputs[s].value.trim();
        if (!t) return;
        state.items.push({ id: uuid(), text: t, sphere: s, date: selectedDate, ts: Date.now() });
        inputs[s].value='';
        flashSubmit(s);
        await doSaveAndRerender();
      }
    });
  }
  ['body','mind','meaning'].forEach(bindInput);

  /* Telegram setup ‚Äî —Å–∫—Ä—ã–≤–∞–µ–º –Ω–∏–∂–Ω—é—é MainButton */
  if (tg){
    tg.ready(); tg.expand(); applyTheme(); setHello();
    tg.onEvent('themeChanged', applyTheme);
    try { tg.MainButton.hide(); tg.MainButton.offClick?.(); } catch(e){}
  } else {
    document.getElementById('hello').textContent = '–ü—Ä–∏–≤–µ—Ç!';
  }

  /* ===== Onboarding ===== */
  const ONB_KEY = 'onboarding_v1_done';
  const onbEl = document.getElementById('onb');
  const onbBody = document.getElementById('onbBody');
  const onbCta  = document.getElementById('onbCta');
  const onbDots = document.getElementById('onbDots');
  const onbSkip = document.getElementById('onbSkip');
  const onbCard = document.getElementById('onbCard');

  // helper: picture HTML (AVIF ‚Üí WebP ‚Üí PNG)
  function heroPicture(base, alt, eager=false){
    const loading = eager ? 'eager' : 'lazy';
    return `
      <picture class="hero-picture">
        <source type="image/avif" srcset="${base}.avif">
        <source type="image/webp" srcset="${base}.webp">
        <img class="hero-img" src="${base}.png" alt="${alt}" loading="${loading}" decoding="async" width="800" height="600"/>
      </picture>
    `;
  }

  const slides = [
    {
      id: 1, dots: 0, skip: false,
      base: 'assets/onb-1',
      h1: '–ü—Ä–∏–≤–µ—Ç! –≠—Ç–æ —Ç—Ä–µ–∫–µ—Ä —Å–∞–º–æ–ø—Ä–æ–∫–∞—á–∫–∏',
      p:  '–ü–æ–º–æ–≥–∞–µ–º —Ä–∞—Å—Ç–∏ –≤ —Ç—Ä—ë—Ö —Å—Ñ–µ—Ä–∞—Ö ‚Äî –¢–µ–ª–æ, –£–º –∏ –°–º—ã—Å–ª. –û—Ç–º–µ—á–∞–π –º–∞–ª–µ–Ω—å–∫–∏–µ –ø–æ–±–µ–¥—ã –∏ —Å–º–æ—Ç—Ä–∏, –∫–∞–∫ —Å–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è –±–æ–ª—å—à–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å.',
      renderBody(){
        onbBody.innerHTML = `
          <div class="onb-hero">${heroPicture(this.base,'–û–Ω–±–æ—Ä–¥–∏–Ω–≥ ‚Äî –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ',true)}</div>
          <div class="onb-h1">${this.h1}</div>
          <div class="onb-p">${this.p}</div>
        `;
        onbCta.innerHTML = `
          <button class="btn-primary" id="onbNext">–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è</button>
          <button class="btn-ghost" id="onbSkipFirst">–†–∞–∑–±–µ—Ä—É—Å—å —Å–∞–º</button>
        `;
        document.getElementById('onbNext').onclick = ()=> go(2);
        document.getElementById('onbSkipFirst').onclick = finishOnboarding;
      }
    },
    {
      id: 2, dots: 1, skip: true,
      base: 'assets/onb-2-body',
      h1: '–¢–µ–ª–æ –∏ —ç–Ω–µ—Ä–≥–∏—è',
      items: [
        '<b>–ß—Ç–æ —ç—Ç–æ.</b> –ë–∞–∑–∞ –∂–∏–∑–Ω–µ–Ω–Ω–æ–π —Å–∏–ª—ã: –¥–≤–∏–∂–µ–Ω–∏–µ, —Å–æ–Ω, –ø–∏—Ç–∞–Ω–∏–µ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ.',
        '<b>–ó–∞—á–µ–º –Ω—É–∂–Ω–æ.</b> –°—Ç–∞–±–∏–ª—å–Ω–∞—è —ç–Ω–µ—Ä–≥–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ, –º–µ–Ω—å—à–µ —Å—Ç—Ä–µ—Å—Å–∞ –∏ ¬´—Ç—É–º–∞–Ω–∞ –≤ –≥–æ–ª–æ–≤–µ¬ª.',
        '<b>–ß—Ç–æ –±—É–¥–µ—à—å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å.</b>',
        '‚Ä¢ –®–∞–≥–∏/–∫–æ—Ä–æ—Ç–∫–æ–µ –∫–∞—Ä–¥–∏–æ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å',
        '‚Ä¢ –°–∏–ª–æ–≤—ã–µ 2√ó –≤ –Ω–µ–¥–µ–ª—é',
        '‚Ä¢ –°–æ–Ω 7‚Äì9 —á–∞—Å–æ–≤ –∏ —Ä–µ–∂–∏–º',
        '‚Ä¢ –ú–∞–ª–µ–Ω—å–∫–∏–µ —Ä–∏—Ç—É–∞–ª—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è (–≤–æ–¥–∞, —É—Ç—Ä–µ–Ω–Ω–∏–π —Å–≤–µ—Ç, 5‚Äì10 –º–∏–Ω —Ä–∞—Å—Ç—è–∂–∫–∏)',
      ],
      hint: '–†–µ–≥—É–ª—è—Ä–Ω–æ—Å—Ç—å –≤–∞–∂–Ω–µ–µ –∏–¥–µ–∞–ª–∞.',
      cta: '–î–∞–ª—å—à–µ'
    },
    {
      id: 3, dots: 2, skip: true,
      base: 'assets/onb-3-mind',
      h1: '–£–º –∏ —Ñ–æ–∫—É—Å',
      items: [
        '<b>–ß—Ç–æ —ç—Ç–æ.</b> –ù–∞–≤—ã–∫–∏ –≤–Ω–∏–º–∞–Ω–∏—è –∏ –º—ã—à–ª–µ–Ω–∏—è: –∫–∞–∫ –≤—ã–±–∏—Ä–∞–µ—à—å —Ñ–æ–∫—É—Å, –≥–æ–≤–æ—Ä–∏—à—å —Å —Å–æ–±–æ–π, —É—á–∏—à—å—Å—è –∏ –ø—Ä–∏–Ω–∏–º–∞–µ—à—å —Ä–µ—à–µ–Ω–∏—è.',
        '<b>–ó–∞—á–µ–º –Ω—É–∂–Ω–æ.</b> –ú–µ–Ω—å—à–µ ¬´–º—ã—Å–ª–µ–Ω–Ω–æ–≥–æ —à—É–º–∞¬ª –∏ —Ç—Ä–µ–≤–æ–≥–∏; –±–æ–ª—å—à–µ —è—Å–Ω–æ—Å—Ç–∏ –∏ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã.',
        '<b>–ß—Ç–æ –±—É–¥–µ—à—å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å.</b>',
        '‚Ä¢ –§–æ–∫—É—Å-—Å–µ—Ç—ã 25‚Äì50 –º–∏–Ω (1‚Äì3 –≤ –¥–µ–Ω—å)',
        '‚Ä¢ 1 –∑–∞–ø–∏—Å—å –≤ –¥–Ω–µ–≤–Ω–∏–∫ –º—ã—Å–ª–µ–π (CBT) –∏–ª–∏ 3 –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏',
        '‚Ä¢ –£—á—ë–±—É/—á—Ç–µ–Ω–∏–µ 30‚Äì60 –º–∏–Ω —Å —Å–∞–º–æ—Ç–µ—Å—Ç–æ–º',
      ],
      hint: '–ú–∞–ª–µ–Ω—å–∫–∏–µ —É–º–Ω—ã–µ —à–∞–≥–∏ ‚Üí –±–æ–ª—å—à–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å.',
      cta: '–î–∞–ª—å—à–µ'
    },
    {
      id: 4, dots: 3, skip: true,
      base: 'assets/onb-4-meaning',
      h1: '–°–º—ã—Å–ª –∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ',
      items: [
        '<b>–ß—Ç–æ —ç—Ç–æ.</b> –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ–ø–æ—Ä–∞ –Ω–∞ —Ü–µ–Ω–Ω–æ—Å—Ç–∏: —É–º–µ–Ω–∏–µ –±—ã—Ç—å –≤ –º–æ–º–µ–Ω—Ç–µ, –ø—Ä–∏–Ω–∏–º–∞—Ç—å –ø–µ—Ä–µ–∂–∏–≤–∞–Ω–∏—è –∏ —á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å —Å–≤—è–∑—å —Å –≤–∞–∂–Ω—ã–º.',
        '<b>–ó–∞—á–µ–º –Ω—É–∂–Ω–æ.</b> –¢–∏—Ö–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤–º–µ—Å—Ç–æ —Å—É–µ—Ç—ã, –º–µ–Ω—å—à–µ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –∫–∞—á–µ–ª–µ–π, —è—Å–Ω–æ–µ ¬´—Ä–∞–¥–∏ —á–µ–≥–æ¬ª.',
        '<b>–ß—Ç–æ –±—É–¥–µ—à—å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å.</b>',
        '‚Ä¢ –ú–µ–¥–∏—Ç–∞—Ü–∏—é/—Å–æ–∑–µ—Ä—Ü–∞–Ω–∏–µ 5‚Äì15 –º–∏–Ω',
        '‚Ä¢ –î—ã—Ö–∞–Ω–∏–µ 6 —Ü–∏–∫–ª–æ–≤/–º–∏–Ω 5‚Äì10 –º–∏–Ω',
        '‚Ä¢ 1 ¬´–∞–∫—Ç —Ü–µ–Ω–Ω–æ—Å—Ç–∏¬ª –≤ –Ω–µ–¥–µ–ª—é',
        '‚Ä¢ –†–µ—Ñ–ª–µ–∫—Å–∏–≤–Ω–æ–µ —á—Ç–µ–Ω–∏–µ 10‚Äì20 –º–∏–Ω (3‚Äì5 —Å—Ç—Ä–æ–∫ ¬´—á—Ç–æ —ç—Ç–æ –º–µ–Ω—è–µ—Ç –≤–æ –º–Ω–µ¬ª)',
      ],
      hint: '–°–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ ‚Äî —ç—Ç–æ —Ç—Ä–µ–Ω–∏—Ä—É–µ–º—ã–π –Ω–∞–≤—ã–∫.',
      cta: '–ù–∞—á–∞—Ç—å —Ç—Ä–µ–∫–µ—Ä'
    }
  ];

  function renderDots(idx){
    onbDots.innerHTML = '';
    if (slides[idx-1].dots === 0){ onbDots.style.visibility='hidden'; return; }
    onbDots.style.visibility='visible';
    const total = 3;
    for (let i=1;i<=total;i++){
      const d = document.createElement('div');
      d.className = 'dot' + (i===slides[idx-1].dots ? ' active' : '');
      d.addEventListener('click', ()=> go(i+1));
      onbDots.appendChild(d);
    }
  }

  function renderSlide(idx){
    const slide = slides[idx-1];
    renderDots(idx);
    onbSkip.style.display = slide.skip ? 'inline' : 'none';
    if (idx === 1){
      slide.renderBody(); return;
    }
    const listHtml = slide.items.map(x=> `<div>${x}</div>`).join('');
    onbBody.innerHTML = `
      <div class="onb-hero">${heroPicture(slide.base,'–û–Ω–±–æ—Ä–¥–∏–Ω–≥ ‚Äî –∏–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è')}</div>
      <div class="onb-h1">${slide.h1}</div>
      <div class="onb-list">${listHtml}</div>
      <div class="onb-hint">${slide.hint}</div>
    `;
    onbCta.innerHTML = `<button class="btn-primary" id="onbNext">${slide.cta}</button>`;
    document.getElementById('onbNext').onclick = ()=> { if (idx<slides.length) go(idx+1); else finishOnboarding(); };
  }

  // swipe
  let sx=null;
  onbCard.addEventListener('pointerdown', e=>{ sx = e.clientX; });
  onbCard.addEventListener('pointerup', e=>{
    if (sx===null) return;
    const dx = e.clientX - sx; sx=null;
    const TH = 60;
    if (Math.abs(dx) < TH) return;
    if (dx<0 && curSlide<4) go(curSlide+1);
    if (dx>0 && curSlide>2) go(curSlide-1);
  });

  onbSkip.addEventListener('click', finishOnboarding);

  async function getOnbDone(){
    if (cloudSupported()){
      try{ const v = await cloudGetItem(ONB_KEY); if (v==='true') return true; }catch{}
    }
    try{ return localStorage.getItem(ONB_KEY)==='true'; }catch{ return false; }
  }
  async function setOnbDone(){
    if (cloudSupported()){ try{ await cloudSetItem(ONB_KEY,'true'); }catch{} }
    try{ localStorage.setItem(ONB_KEY,'true'); }catch{}
  }

  function showOnboarding(startAt=1){
    onbEl.classList.add('show');
    go(startAt);
  }
  async function finishOnboarding(){
    await setOnbDone();
    onbEl.classList.remove('show');
  }

  let curSlide = 1;
  function go(n){
    if (n < 2 && curSlide >= 2) n = 2; // –Ω–µ –¥–∞—ë–º –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ 1-–π –ø—Ä–∏ ¬´–∫—Ä–∞—Ç–∫–æ–º¬ª
    curSlide = n;
    renderSlide(n);
  }

  // –ø—Ä–µ–ª–æ–∞–¥ –ø—Ä–æ—á–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
  ['assets/onb-2-body.avif','assets/onb-3-mind.avif','assets/onb-4-meaning.avif']
    .forEach(src=>{ const im = new Image(); im.src = src; });

  /* Init */
  (async ()=>{
    state = await loadState();
    if (!state.createdAt){ state.createdAt = todayISO(); }
    if (!state.scores){ state.scores = {body:0,mind:0,meaning:0}; }

    recomputeScores();
    await saveState(state);

    renderBars(); renderDayTitle(); renderDays(); renderList();
    streakEl.textContent = calcStreak();

    // —Å–∫—Ä—ã–≤–∞–µ–º MainButton –¢–µ–ª–µ–≥–∏
    try{ tg?.MainButton?.hide(); tg?.MainButton?.offClick?.(); }catch{}

    // –ü–æ–∫–∞–∂–µ–º –æ–Ω–±–æ—Ä–¥–∏–Ω–≥ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å–∞–º–æ–º –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ
    const done = await getOnbDone();
    if (!done){ showOnboarding(1); }
  })();
});
</script>
</body>
</html>
