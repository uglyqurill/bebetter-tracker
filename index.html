<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BeBetter ¬∑ –¢—Ä–µ–∫–µ—Ä</title>

  <!-- –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç Telegram WebApp -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    :root{
      /* –ü–∞–ª–∏—Ç—Ä–∞ */
      --text:#ffffff;
      --muted:#C7E2FF;

      --bg1:#0F5CC0; /* —è—Ä–∫–æ-—Å–∏–Ω–∏–π (–Ω–µ–±–æ/–æ–∫–µ–∞–Ω) */
      --bg2:#0049A8;
      --bg3:#003C99;
      --bg4:#003080;

      --card:#0b3a7a;
      --line:#1b5fd1;
      --accent:#19E0FF;    /* —Ü–∏–∞–Ω-–∞–∫—Ü–µ–Ω—Ç */
      --accent-2:#7AE7FF;  /* —Å–≤–µ—Ç–ª—ã–π —Ü–∏–∞–Ω */

      /* —Ü–≤–µ—Ç–∞ —Å—Ñ–µ—Ä */
      --body:#2dd4bf;      /* –º—è—Ç–Ω–æ-—Ü–∏–∞–Ω–æ–≤—ã–π */
      --mind:#60a5fa;      /* –Ω–µ–±–µ—Å–Ω–æ-—Å–∏–Ω–∏–π */
      --meaning:#a78bfa;   /* —Å–∏—Ä–µ–Ω–µ–≤—ã–π */

      --empty:#275aaa;     /* –ø—É—Å—Ç–æ–π —Å–µ–∫—Ç–æ—Ä –¥–Ω—è */
      --danger:#ef4444;
      --ok:#22c55e;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--text);
      background:
        linear-gradient(180deg,var(--bg1) 0%, var(--bg2) 35%, var(--bg3) 60%, var(--bg4) 100%);
    }
    .wrap{max-width:900px;margin:0 auto;padding:16px 14px 120px}

    /* ===== –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å ===== */
    .topbar{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:10px}
    .hello{display:flex;align-items:center;gap:10px;font-weight:600;font-size:16px}
    .hello .avatar{
      width:34px;height:34px;border-radius:999px;
      background:linear-gradient(135deg,#1b4f9e,#0f3c81);display:grid;place-items:center;
      font-weight:800;color:#E7F3FF
    }
    .streak{
      display:flex;align-items:center;gap:8px;
      background:
        linear-gradient(#0f3f87,#0c3270) padding-box,
        linear-gradient(45deg,#ffd166,#ff9f1c) border-box;
      border:1px solid transparent;border-radius:14px;padding:8px 12px;
      color:#ffd166;font-weight:800;min-width:72px;justify-content:center
    }
    .streak .ico{filter: drop-shadow(0 0 6px rgba(255,165,0,.35))}
    .sep{height:1px;background:linear-gradient(90deg,transparent, rgba(255,255,255,.25), transparent);margin:12px 0}

    /* ===== –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å ===== */
    .days{
      display:flex;gap:10px;overflow-x:auto;overflow-y:visible;
      padding:8px 0; /* ‚Üë –¥–æ–±–∞–≤–∏–ª –≤–µ—Ä—Ö/–Ω–∏–∑, —á—Ç–æ–±—ã —Ç–µ–Ω–∏ –∏ —Ä–∞–º–∫–∏ –Ω–µ –æ–±—Ä–µ–∑–∞–ª–∏—Å—å */
      scroll-snap-type:x proximity
    }
    .day{
      flex:0 0 auto;scroll-snap-align:center;width:64px;border-radius:16px;padding:10px 8px;
      text-align:center;cursor:pointer;user-select:none;transition:transform .12s ease;
      background:var(--card);border:1px solid rgba(255,255,255,.18)
    }
    .day:hover{transform:translateY(-2px)}
    .day.selected{
      background:
        linear-gradient(180deg, rgba(25,224,255,.15), rgba(122,231,255,.08)) padding-box,
        linear-gradient(60deg, var(--body), var(--mind), var(--meaning)) border-box;
      border:1px solid transparent;
      box-shadow:0 0 16px rgba(122,231,255,.25);
    }
    .day .dow{font-size:11px;color:var(--muted);letter-spacing:.06em;text-transform:uppercase}
    .day .num{font-size:20px;font-weight:900;line-height:1.1;margin:4px 0 6px;color:#fff}

    /* –ö–æ–ª—å—Ü–æ-—Å–µ–∫—Ç–æ—Ä—ã (–Ω–µ ¬´–ø–∏—Ü—Ü–∞¬ª): –∏—Å–ø–æ–ª—å–∑—É–µ–º –º–∞—Å–∫—É, —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ –∫–æ–Ω—Ç—É—Ä */
    .ring{
      --seg1: var(--empty);
      --seg2: var(--empty);
      --seg3: var(--empty);
      width:38px;height:38px;border-radius:999px;margin:0 auto;
      background: conic-gradient(var(--seg1) 0 120deg, var(--seg2) 120deg 240deg, var(--seg3) 240deg 360deg);
      border:2px solid rgba(255,255,255,.18);
      /* –º–∞—Å–∫–∞: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –∫–æ–ª—å—Ü–æ —Ç–æ–ª—â–∏–Ω–æ–π 6px */
      -webkit-mask: radial-gradient(farthest-side, transparent calc(100% - 6px), #000 calc(100% - 6px));
              mask: radial-gradient(farthest-side, transparent calc(100% - 6px), #000 calc(100% - 6px));
    }

    /* ===== –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä—ã —Å—Ñ–µ—Ä ===== */
    .spheres{display:grid;grid-template-columns:1fr;gap:12px;margin:12px 0 10px}
    @media (min-width:740px){ .spheres{grid-template-columns:1fr 1fr 1fr} }
    .sphere{
      background:linear-gradient(180deg,#0f3f87,#0c3270);
      border:1px solid rgba(255,255,255,.18);border-radius:16px;padding:12px
    }
    .sphere .row{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
    .tag{display:inline-flex;align-items:center;gap:8px;font-weight:800}
    .tag .dot{width:10px;height:10px;border-radius:999px}
    .meter{
      height:14px;border-radius:999px;background:rgba(255,255,255,.12);
      border:1px solid rgba(255,255,255,.2);overflow:hidden;position:relative
    }
    .fill{height:100%;width:0%;transition: width .35s ease-out;}
    .sphere[data-s="body"] .fill{ background:linear-gradient(90deg, var(--body), #5ff4e3); }
    .sphere[data-s="mind"] .fill{ background:linear-gradient(90deg, var(--mind), #a5d8ff); }
    .sphere[data-s="meaning"] .fill{ background:linear-gradient(90deg, var(--meaning), #d8c9ff); }
    .pct{font-variant-numeric:tabular-nums;color:#fff;font-weight:800}

    /* ===== –ü–æ–¥–ø–∏—Å—å –¥–Ω—è + info ===== */
    .daytitle{display:flex;align-items:center;justify-content:space-between;margin:6px 0 6px}
    .daytitle .label{font-weight:900;font-size:18px;color:#fff}
    .icon-btn{
      width:36px;height:36px;border-radius:999px;
      background:
        linear-gradient(#0f3f87,#0c3270) padding-box,
        linear-gradient(45deg, #19E0FF, #7AE7FF) border-box;
      border:1px solid transparent;
      display:grid;place-items:center;cursor:pointer;transition:transform .12s ease;
      color:#fff; font-weight:900; /* –∂–∏—Ä–Ω–∞—è i */
    }
    .icon-btn:hover{transform:translateY(-1px)}

    /* ===== –í–≤–æ–¥ –ø–æ–±–µ–¥ ===== */
    .inputs{display:grid;grid-template-columns:1fr;gap:12px;margin-top:10px}
    @media (min-width:740px){ .inputs{grid-template-columns:1fr 1fr 1fr} }
    .input-card{
      background:linear-gradient(180deg,#0f3f87,#0c3270);
      border:1px solid rgba(255,255,255,.18);border-radius:16px;padding:12px;display:flex;flex-direction:column;gap:8px
    }
    .input-card .hdr{display:flex;align-items:center;gap:8px;font-weight:800;color:#fff}
    .input{display:flex;gap:8px;align-items:center}
    input[type="text"]{
      flex:1;padding:12px 12px;border-radius:12px;border:1px solid #1A5ED1;background:#08356E;color:#fff;outline:none;font-size:14px
    }
    input::placeholder{color:#9CCAFF}
    .submit{
      width:44px;height:44px;border-radius:12px;
      background:
        linear-gradient(#0f3f87,#0c3270) padding-box,
        linear-gradient(45deg, #19E0FF, #7AE7FF) border-box;
      border:1px solid transparent;
      display:grid;place-items:center;cursor:pointer;font-size:18px;color:#fff;font-weight:800
    }
    .small{font-size:12px;color:var(--muted)}

    /* ===== –°–ø–∏—Å–æ–∫ –ø–æ–±–µ–¥ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –¥–Ω—è ===== */
    .list{margin-top:12px; display:grid; gap:8px}
    .item{
      background:linear-gradient(180deg,#0f3f87,#0c3270);
      border:1px solid rgba(255,255,255,.18);border-radius:14px;padding:10px;
      display:flex;align-items:center;justify-content:space-between;gap:10px
    }
    .item .left{display:flex;align-items:flex-start;gap:8px}
    .pill{font-size:12px;padding:4px 8px;border-radius:999px;border:1px solid rgba(255,255,255,.25);background:rgba(255,255,255,.12);color:#fff}
    .actions{display:flex;gap:6px}
    .btn{
      height:32px;min-width:32px;border-radius:10px;
      background:
        linear-gradient(#0f3f87,#0c3270) padding-box,
        linear-gradient(45deg, #19E0FF, #7AE7FF) border-box;
      border:1px solid transparent;display:grid;place-items:center;cursor:pointer;color:#fff;font-weight:800
    }

    /* ===== –ú–æ–¥–∞–ª–∫–∞ ===== */
    .modal{position:fixed;inset:0;background:rgba(5,10,20,.55);display:none;align-items:center;justify-content:center;padding:16px;z-index:20}
    .modal.show{display:flex}
    .sheet{
      width:min(880px,96vw);max-height:86vh;overflow:auto;background:#0f3f87;border:1px solid rgba(255,255,255,.18);border-radius:18px;padding:14px 14px 16px;color:#fff
    }
    .sheet h3{margin:6px 0 12px}
    .grid{display:grid;gap:10px}
    @media (min-width:740px){ .grid{grid-template-columns:1fr 1fr 1fr} }
    .card{background:#0c3270;border:1px solid rgba(255,255,255,.18);border-radius:14px;padding:10px}
    .card .title{display:flex;align-items:center;gap:8px;font-weight:900;margin-bottom:6px}
    .modal .close{position:sticky;top:0;margin-left:auto;margin-bottom:8px}
    /* Scrollbar */
    .days::-webkit-scrollbar{height:8px}
    .days::-webkit-scrollbar-thumb{background:rgba(255,255,255,.25);border-radius:8px}
  </style>
</head>
<body>
  <div class="wrap">
    <!-- 1. –í–µ—Ä—Ö: –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ + —Å—Ç—Ä–∏–∫ -->
    <div class="topbar">
      <div class="hello">
        <div class="avatar">BB</div>
        <div id="hello">–ü—Ä–∏–≤–µ—Ç!</div>
      </div>
      <div class="streak" title="–°–µ—Ä–∏—è –¥–Ω–µ–π —Å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é">
        <span class="ico">üî•</span><span id="streak">0</span>
      </div>
    </div>
    <div class="sep"></div>

    <!-- 2. –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å -->
    <div id="days" class="days" aria-label="–õ–µ–Ω—Ç–∞ –¥–Ω–µ–π"></div>

    <!-- 3. –°—Ç–∞—Ç—É—Å-–±–∞—Ä—ã —Å—Ñ–µ—Ä -->
    <div class="spheres">
      <div class="sphere" data-s="body">
        <div class="row">
          <div class="tag"><span class="dot" style="background:var(--body)"></span>–¢–µ–ª–æ –∏ —ç–Ω–µ—Ä–≥–∏—è</div>
          <div class="pct" id="pct-body">0/100</div>
        </div>
        <div class="meter"><div class="fill" id="bar-body"></div></div>
      </div>
      <div class="sphere" data-s="mind">
        <div class="row">
          <div class="tag"><span class="dot" style="background:var(--mind)"></span>–£–º –∏ —Ñ–æ–∫—É—Å</div>
          <div class="pct" id="pct-mind">0/100</div>
        </div>
        <div class="meter"><div class="fill" id="bar-mind"></div></div>
      </div>
      <div class="sphere" data-s="meaning">
        <div class="row">
          <div class="tag"><span class="dot" style="background:var(--meaning)"></span>–°–º—ã—Å–ª –∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ</div>
          <div class="pct" id="pct-meaning">0/100</div>
        </div>
        <div class="meter"><div class="fill" id="bar-meaning"></div></div>
      </div>
    </div>

    <!-- 4. –ù–∞–¥–ø–∏—Å—å –¥–Ω—è + info -->
    <div class="daytitle">
      <div class="label" id="dayLabel">–°–µ–≥–æ–¥–Ω—è</div>
      <button class="icon-btn" id="infoBtn" title="–ß—Ç–æ –æ–∑–Ω–∞—á–∞—é—Ç —Å—Ñ–µ—Ä—ã?"><b>i</b></button>
    </div>

    <!-- 5. –ë–ª–æ–∫–∏ –≤–≤–æ–¥–∞ –ø–æ–±–µ–¥ -->
    <div class="inputs">
      <div class="input-card" data-s="body">
        <div class="hdr"><span class="dot" style="background:var(--body)"></span>–¢–µ–ª–æ –∏ —ç–Ω–µ—Ä–≥–∏—è</div>
        <div class="input">
          <input id="inp-body" type="text" placeholder="–ù–∞–ø—Ä.: 30 –º–∏–Ω —Ö–æ–¥—å–±—ã ¬∑ –∑–∞—Ä—è–¥–∫–∞" />
          <button class="submit" id="btn-body" title="–î–æ–±–∞–≤–∏—Ç—å –ø–æ–±–µ–¥—É">‚úî</button>
        </div>
        <div class="small">1-—è –ø–æ–±–µ–¥–∞ –¥–Ω—è: +3, –∫–∞–∂–¥–∞—è —Å–ª–µ–¥—É—é—â–∞—è —Å–µ–≥–æ–¥–Ω—è: +1</div>
      </div>

      <div class="input-card" data-s="mind">
        <div class="hdr"><span class="dot" style="background:var(--mind)"></span>–£–º –∏ —Ñ–æ–∫—É—Å</div>
        <div class="input">
          <input id="inp-mind" type="text" placeholder="–ù–∞–ø—Ä.: 2 —Ñ–æ–∫—É—Å-—Å–µ—Ç–∞ ¬∑ –∑–∞–º–µ—Ç–∫–∞ CBT" />
          <button class="submit" id="btn-mind" title="–î–æ–±–∞–≤–∏—Ç—å –ø–æ–±–µ–¥—É">‚úî</button>
        </div>
        <div class="small">1-—è –ø–æ–±–µ–¥–∞ –¥–Ω—è: +3, –∫–∞–∂–¥–∞—è —Å–ª–µ–¥—É—é—â–∞—è —Å–µ–≥–æ–¥–Ω—è: +1</div>
      </div>

      <div class="input-card" data-s="meaning">
        <div class="hdr"><span class="dot" style="background:var(--meaning)"></span>–°–º—ã—Å–ª –∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ</div>
        <div class="input">
          <input id="inp-meaning" type="text" placeholder="–ù–∞–ø—Ä.: 10 –º–∏–Ω –º–µ–¥–∏—Ç–∞—Ü–∏–∏ ¬∑ –∞–∫—Ç —Ü–µ–Ω–Ω–æ—Å—Ç–∏" />
          <button class="submit" id="btn-meaning" title="–î–æ–±–∞–≤–∏—Ç—å –ø–æ–±–µ–¥—É">‚úî</button>
        </div>
        <div class="small">1-—è –ø–æ–±–µ–¥–∞ –¥–Ω—è: +3, –∫–∞–∂–¥–∞—è —Å–ª–µ–¥—É—é—â–∞—è —Å–µ–≥–æ–¥–Ω—è: +1</div>
      </div>
    </div>

    <!-- –°–ø–∏—Å–æ–∫ –ø–æ–±–µ–¥ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –¥–Ω—è -->
    <div id="list" class="list"></div>
    <div id="empty" class="empty" style="display:none">–ü–æ–∫–∞ –Ω–µ—Ç –ø–æ–±–µ–¥ –∑–∞ —ç—Ç–æ—Ç –¥–µ–Ω—å ‚Äî —Å–∞–º–æ–µ –≤—Ä–µ–º—è –Ω–∞—á–∞—Ç—å üí™</div>
  </div>

  <!-- –ú–æ–¥–∞–ª–∫–∞ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º —Å—Ñ–µ—Ä -->
  <div class="modal" id="modal">
    <div class="sheet">
      <button class="icon-btn close" id="closeModal">‚úï</button>
      <h3>–¢—Ä–∏ —Å—Ñ–µ—Ä—ã —Ä–∞–∑–≤–∏—Ç–∏—è</h3>
      <div class="grid">
        <div class="card">
          <div class="title"><span class="dot" style="background:var(--body)"></span>–¢–µ–ª–æ –∏ —ç–Ω–µ—Ä–≥–∏—è</div>
          <div class="small">
            <b>–û–ø–∏—Å–∞–Ω–∏–µ.</b> –ë–∞–∑–∞ –∂–∏–∑–Ω–µ–Ω–Ω–æ–π —Å–∏–ª—ã: –¥–≤–∏–∂–µ–Ω–∏–µ, —Å–æ–Ω, –ø–∏—Ç–∞–Ω–∏–µ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ.<br/>
            <b>–≠—Ñ—Ñ–µ–∫—Ç.</b> –ë–æ–ª—å—à–µ —ç–Ω–µ—Ä–≥–∏–∏ –∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ; –º–µ–Ω—å—à–µ —Å—Ç—Ä–µ—Å—Å–∞; –ª—É—á—à–µ —Ñ–æ—Ä–º–∞ –∏ –∑–¥–æ—Ä–æ–≤—å–µ.<br/>
            <b>–ß—Ç–æ –¥–µ–ª–∞—Ç—å.</b> 7‚Äì10 —Ç—ã—Å. —à–∞–≥–æ–≤/–¥–µ–Ω—å; 150 –º–∏–Ω –∫–∞—Ä–¥–∏–æ/–Ω–µ–¥ + —Å–∏–ª–æ–≤—ã–µ 2√ó; —Å–æ–Ω 7‚Äì9 —á; –±–µ–ª–æ–∫ –∏ –æ–≤–æ—â–∏ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å.
          </div>
        </div>
        <div class="card">
          <div class="title"><span class="dot" style="background:var(--mind)"></span>–£–º –∏ —Ñ–æ–∫—É—Å</div>
          <div class="small">
            <b>–û–ø–∏—Å–∞–Ω–∏–µ.</b> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–Ω–∏–º–∞–Ω–∏–µ–º –∏ –º—ã—Å–ª—è–º–∏ –¥–ª—è —è—Å–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π –∏ —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏.<br/>
            <b>–≠—Ñ—Ñ–µ–∫—Ç.</b> –ú–µ–Ω—å—à–µ —Ç—Ä–µ–≤–æ–≥–∏ –∏ ¬´—à—É–º–∞¬ª; –±–æ–ª—å—à–µ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏; –±—ã—Å—Ç—Ä–µ–µ —É—á–∏—à—å—Å—è.<br/>
            <b>–ß—Ç–æ –¥–µ–ª–∞—Ç—å.</b> –§–æ–∫—É—Å-—Å–µ—Ç—ã 25‚Äì50 –º–∏–Ω; –¥–Ω–µ–≤–Ω–∏–∫ –º—ã—Å–ª–µ–π (CBT) 1 –∑–∞–ø–∏—Å—å/–¥–µ–Ω—å; 3 –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏; —É—á—ë–±–∞ 30‚Äì60 –º–∏–Ω —Å —Å–∞–º–æ—Ç–µ—Å—Ç–æ–º.
          </div>
        </div>
        <div class="card">
          <div class="title"><span class="dot" style="background:var(--meaning)"></span>–°–º—ã—Å–ª –∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ</div>
          <div class="small">
            <b>–û–ø–∏—Å–∞–Ω–∏–µ.</b> –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ–ø–æ—Ä–∞ –Ω–∞ —Ü–µ–Ω–Ω–æ—Å—Ç–∏, –ø—Ä–∏–Ω—è—Ç–∏–µ –ø–µ—Ä–µ–∂–∏–≤–∞–Ω–∏–π –∏ —Å–≤—è–∑—å —Å ¬´–±–æ–ª—å—à–∏–º¬ª.<br/>
            <b>–≠—Ñ—Ñ–µ–∫—Ç.</b> –ì–ª—É–±–æ–∫–∏–π –ø–æ–∫–æ–π; —Å–æ—Å—Ç—Ä–∞–¥–∞–Ω–∏–µ –∫ —Å–µ–±–µ –∏ –¥—Ä—É–≥–∏–º; —è—Å–Ω–æ–µ ¬´–∑–∞—á–µ–º¬ª.<br/>
            <b>–ß—Ç–æ –¥–µ–ª–∞—Ç—å.</b> –ú–µ–¥–∏—Ç–∞—Ü–∏—è/—Å–æ–∑–µ—Ä—Ü–∞–Ω–∏–µ 5‚Äì15 –º–∏–Ω; –¥—ã—Ö–∞–Ω–∏–µ 6 —Ü/–º–∏–Ω 5‚Äì10 –º–∏–Ω; 1 ¬´–∞–∫—Ç —Ü–µ–Ω–Ω–æ—Å—Ç–∏¬ª/–Ω–µ–¥; —Ä–µ—Ñ–ª–µ–∫—Å–∏–≤–Ω–æ–µ —á—Ç–µ–Ω–∏–µ 10‚Äì20 –º–∏–Ω.
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
window.addEventListener('DOMContentLoaded', () => {
  /* ===== Telegram WebApp ===== */
  const tg = (window.Telegram && window.Telegram.WebApp) ? window.Telegram.WebApp : null;

  // –ë–µ—Ä—ë–º –∏–∑ —Ç–µ–º—ã —Ç–æ–ª—å–∫–æ –∞–∫—Ü–µ–Ω—Ç, –ù–û –ù–ï —Ü–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ (–æ—Å—Ç–∞–≤–ª—è–µ–º –±–µ–ª—ã–π)
  function applyTheme() {
    if (!tg) return;
    const p = tg.themeParams || {};
    const css = document.documentElement.style;
    if (p.button_color) css.setProperty('--accent', '#' + p.button_color);
    if (p.button_color) css.setProperty('--accent-2', '#' + p.button_color);
  }

  function setHello() {
    const u = tg?.initDataUnsafe?.user;
    const name = u?.first_name ? u.first_name : '–¥—Ä—É–≥';
    document.getElementById('hello').textContent = `–ü—Ä–∏–≤–µ—Ç, ${name}!`;
    const av = document.querySelector('.avatar');
    av.textContent = (u?.first_name || 'BB').slice(0,2).toUpperCase();
  }

  /* ===== CloudStorage wrappers ===== */
  function cloudSupported(){ return !!(tg && tg.CloudStorage); }
  function cloudGetItem(key){
    return new Promise((res,rej)=> tg.CloudStorage.getItem(key,(err,val)=> err?rej(err):res(val??'') ));
  }
  function cloudSetItem(key,val){
    return new Promise((res,rej)=> tg.CloudStorage.setItem(key,String(val),(err,ok)=> (err||!ok)?rej(err||new Error('setItem failed')):res() ));
  }

  /* ===== Utilities ===== */
  const uuid = () =>
    (crypto?.randomUUID) ? crypto.randomUUID()
      : 'id-' + Date.now().toString(36) + '-' + Math.random().toString(36).slice(2,8);

  const fmtISO = (d)=> new Date(d).toISOString().slice(0,10);
  const todayISO = ()=> fmtISO(new Date());
  const addDays = (iso,dx)=> fmtISO(new Date(new Date(iso).setDate(new Date(iso).getDate()+dx)));
  const diffDays = (a,b)=> Math.round((new Date(a)-new Date(b))/86400000);
  const DOW = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];

  /* ===== State & storage ===== */
  const KEY = 'victory-tracker-v1';
  let state = {
    items: [], // {id,text,sphere:'body'|'mind'|'meaning',date:'YYYY-MM-DD',ts:number}
    scores: { body:0, mind:0, meaning:0 }, // 0..100
    createdAt: null // –∫–æ–≥–¥–∞ –Ω–∞—á–∞–ª–∏ –≤–µ—Å—Ç–∏ —É—á—ë—Ç
  };

  async function loadState(){
    if (cloudSupported()){
      try { const raw = await cloudGetItem(KEY); if (raw) return JSON.parse(raw); } catch(e){}
    }
    try { return JSON.parse(localStorage.getItem(KEY)) || state; } catch { return state; }
  }
  async function saveState(s){
    if (cloudSupported()){ try { await cloudSetItem(KEY, JSON.stringify(s)); } catch(e){} }
    try { localStorage.setItem(KEY, JSON.stringify(s)); } catch(e){}
  }

  /* ===== –ü–æ–¥—Å—á—ë—Ç –æ—á–∫–æ–≤ –∑–∞–Ω–æ–≤–æ (–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ) =====
     –ü—Ä–∞–≤–∏–ª–∞:
     - –∑–∞ –¥–µ–Ω—å –∏ —Å—Ñ–µ—Ä—É: +3 –∑–∞ –ø–µ—Ä–≤—É—é –ø–æ–±–µ–¥—É; +1 –∑–∞ –∫–∞–∂–¥—É—é —Å–ª–µ–¥—É—é—â—É—é –≤ —ç—Ç–æ—Ç –∂–µ –¥–µ–Ω—å;
     - –∑–∞ –¥–µ–Ω—å –±–µ–∑ –ø–æ–±–µ–¥ –≤ —Å—Ñ–µ—Ä–µ (–ø—Ä–æ—à–µ–¥—à–∏–π –¥–µ–Ω—å): -5;
     - –∏—Ç–æ–≥ –Ω–µ –Ω–∏–∂–µ 0, –Ω–µ –≤—ã—à–µ 100;
     - –∑–∞ —Ç–µ–∫—É—â–∏–π –¥–µ–Ω—å –±–µ–∑ –ø–æ–±–µ–¥ —à—Ç—Ä–∞—Ñ –ù–ï –Ω–∞—á–∏—Å–ª—è–µ–º.
  */
  function recomputeScores(){
    const today = todayISO();
    const allDates = state.items.map(i=>i.date);
    const minItemDate = allDates.length ? allDates.reduce((a,b)=> a<b?a:b) : today;
    const startDate = state.createdAt ? (state.createdAt < minItemDate ? state.createdAt : minItemDate) : minItemDate;

    const counts = {}; // counts[iso] = {body:n, mind:n, meaning:n}
    state.items.forEach(it=>{
      counts[it.date] = counts[it.date] || {body:0,mind:0,meaning:0};
      counts[it.date][it.sphere] = (counts[it.date][it.sphere]||0) + 1;
    });

    const scores = { body:0, mind:0, meaning:0 };

    // –ò–¥—ë–º –ø–æ –¥–Ω—è–º –æ—Ç startDate –¥–æ today
    let d = startDate;
    while (new Date(d) <= new Date(today)){
      const dayCounts = counts[d] || {body:0,mind:0,meaning:0};
      ['body','mind','meaning'].forEach(s=>{
        const c = dayCounts[s]||0;
        if (c>0){
          // +3 –∑–∞ –ø–µ—Ä–≤—É—é, +1 –∑–∞ –∫–∞–∂–¥—É—é –ø–æ—Å–ª–µ–¥—É—é—â—É—é
          scores[s] += 3 + (c-1)*1;
        } else {
          // —à—Ç—Ä–∞—Ñ—ã —Ç–æ–ª—å–∫–æ –¥–ª—è –¥–Ω–µ–π –¥–æ —Å–µ–≥–æ–¥–Ω—è
          if (d !== today) scores[s] -= 5;
        }
        // –æ–≥—Ä–∞–Ω–∏—á–∏—Ç–µ–ª–∏ –ø–æ –¥–Ω—é
        if (scores[s] < 0) scores[s] = 0;
        if (scores[s] > 100) scores[s] = 100;
      });
      d = addDays(d, +1);
    }

    state.scores = scores;
  }

  /* ===== UI refs ===== */
  const daysEl = document.getElementById('days');
  const listEl = document.getElementById('list');
  const emptyEl = document.getElementById('empty');
  const dayLabelEl = document.getElementById('dayLabel');
  const streakEl = document.getElementById('streak');

  const bars = {
    body: document.getElementById('bar-body'),
    mind: document.getElementById('bar-mind'),
    meaning: document.getElementById('bar-meaning'),
  };
  const pcts = {
    body: document.getElementById('pct-body'),
    mind: document.getElementById('pct-mind'),
    meaning: document.getElementById('pct-meaning'),
  };
  const inputs = {
    body: document.getElementById('inp-body'),
    mind: document.getElementById('inp-mind'),
    meaning: document.getElementById('inp-meaning'),
  };
  const buttons = {
    body: document.getElementById('btn-body'),
    mind: document.getElementById('btn-mind'),
    meaning: document.getElementById('btn-meaning'),
  };

  /* ===== Selected day ===== */
  let selectedDate = todayISO();

  function labelForDay(iso){
    const t = todayISO();
    const d = diffDays(iso,t);
    if (d===0) return '–°–µ–≥–æ–¥–Ω—è';
    if (d===-1) return '–í—á–µ—Ä–∞';
    if (d===+1) return '–ó–∞–≤—Ç—Ä–∞';
    const dt = new Date(iso);
    const dd = String(dt.getDate()).padStart(2,'0');
    const mm = String(dt.getMonth()+1).padStart(2,'0');
    return `${dd}.${mm}.${dt.getFullYear()}`;
  }

  /* ===== Calendar render ===== */
  function dayHasSphere(iso, sphere){
    return state.items.some(it=> it.date===iso && it.sphere===sphere);
  }

  function renderDays(){
    daysEl.innerHTML = '';
    const start = addDays(todayISO(), -21);
    const end = addDays(todayISO(), +7);
    let cur = start;
    while (new Date(cur) <= new Date(end)){
      const dv = document.createElement('div');
      dv.className = 'day' + (cur===selectedDate ? ' selected' : '');
      dv.dataset.iso = cur;

      const dow = document.createElement('div');
      dow.className = 'dow';
      dow.textContent = DOW[new Date(cur).getDay()];
      const num = document.createElement('div');
      num.className = 'num';
      num.textContent = new Date(cur).getDate();

      const r = document.createElement('div');
      r.className = 'ring';
      // –≤—ã—Å—Ç–∞–≤–ª—è–µ–º —Ü–≤–µ—Ç–∞ —Å–µ–∫—Ç–æ—Ä–æ–≤ —á–µ—Ä–µ–∑ css-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –ø—É—Å—Ç—ã–µ —Å–µ–≥–º–µ–Ω—Ç—ã -> --empty
      r.style.setProperty('--seg1', dayHasSphere(cur,'body') ? 'var(--body)' : 'var(--empty)');
      r.style.setProperty('--seg2', dayHasSphere(cur,'mind') ? 'var(--mind)' : 'var(--empty)');
      r.style.setProperty('--seg3', dayHasSphere(cur,'meaning') ? 'var(--meaning)' : 'var(--empty)');

      dv.appendChild(dow);
      dv.appendChild(num);
      dv.appendChild(r);

      dv.addEventListener('click', ()=>{
        selectedDate = dv.dataset.iso;
        renderDays();
        renderDayTitle();
        renderList();
      });

      daysEl.appendChild(dv);
      cur = addDays(cur, +1);
    }
    const sel = daysEl.querySelector('.day.selected');
    if (sel) sel.scrollIntoView({behavior:'smooth',inline:'center',block:'nearest'});
  }

  /* ===== Streak ===== */
  function calcStreak(){
    const days = new Set(state.items.map(i=> i.date));
    let d = todayISO();
    if (!days.has(d)) d = addDays(d, -1);
    let cnt = 0;
    while (days.has(d)){ cnt++; d = addDays(d, -1); }
    return cnt;
  }

  /* ===== Bars & title ===== */
  function renderBars(){
    ['body','mind','meaning'].forEach(s=>{
      const v = Math.max(0, Math.min(100, Math.round(state.scores[s]||0)));
      bars[s].style.width = v + '%';
      pcts[s].textContent = v + '/100';
    });
  }
  function renderDayTitle(){ dayLabelEl.textContent = labelForDay(selectedDate); }

  /* ===== List of victories for selected day ===== */
  function sphereLabel(s){ return s==='body' ? '–¢–µ–ª–æ' : (s==='mind' ? '–£–º' : '–°–º—ã—Å–ª'); }
  function sphereColor(s){ return s==='body' ? 'var(--body)' : (s==='mind' ? 'var(--mind)' : 'var(--meaning)'); }
  function escapeHtml(s){ return String(s).replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

  async function doSaveAndRerender(){
    recomputeScores();
    await saveState(state);
    renderBars(); renderDays(); renderList(); streakEl.textContent = calcStreak();
  }

  function renderList(){
    const items = state.items.filter(i=> i.date===selectedDate).sort((a,b)=> b.ts - a.ts);
    listEl.innerHTML = '';
    if (items.length === 0){ emptyEl.style.display = 'block'; return; }
    emptyEl.style.display = 'none';

    items.forEach(it=>{
      const row = document.createElement('div'); row.className = 'item';
      const left = document.createElement('div'); left.className = 'left';

      const pill = document.createElement('div'); pill.className='pill'; pill.textContent = sphereLabel(it.sphere);
      const text = document.createElement('div');
      text.innerHTML = `<div>${escapeHtml(it.text)}</div><div class="small" style="color:${sphereColor(it.sphere)}">${it.date}</div>`;
      left.appendChild(pill); left.appendChild(text);

      const act = document.createElement('div'); act.className='actions';
      const bEdit = document.createElement('button'); bEdit.className='btn'; bEdit.title='–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å'; bEdit.textContent='‚úé';
      const bDel  = document.createElement('button'); bDel.className='btn';  bDel.title='–£–¥–∞–ª–∏—Ç—å';      bDel.textContent='üóë';

      bEdit.addEventListener('click', async ()=>{
        const nv = prompt('–ò–∑–º–µ–Ω–∏ —Ç–µ–∫—Å—Ç –ø–æ–±–µ–¥—ã:', it.text);
        if (nv && nv.trim()){
          it.text = nv.trim();
          await doSaveAndRerender();
        }
      });
      bDel.addEventListener('click', async ()=>{
        if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –ø–æ–±–µ–¥—É?')){
          state.items = state.items.filter(x=>x.id!==it.id);
          await doSaveAndRerender();
        }
      });

      act.appendChild(bEdit); act.appendChild(bDel);
      row.appendChild(left); row.appendChild(act);
      listEl.appendChild(row);
    });
  }

  /* ===== Info modal ===== */
  const modal = document.getElementById('modal');
  document.getElementById('infoBtn').addEventListener('click', ()=> modal.classList.add('show'));
  document.getElementById('closeModal').addEventListener('click', ()=> modal.classList.remove('show'));
  modal.addEventListener('click', (e)=>{ if (e.target===modal) modal.classList.remove('show'); });

  /* ===== Inputs ===== */
  const inputs = {
    body: document.getElementById('inp-body'),
    mind: document.getElementById('inp-mind'),
    meaning: document.getElementById('inp-meaning'),
  };
  const buttons = {
    body: document.getElementById('btn-body'),
    mind: document.getElementById('btn-mind'),
    meaning: document.getElementById('btn-meaning'),
  };

  function bindInput(s){
    buttons[s].addEventListener('click', async ()=>{
      const t = inputs[s].value.trim();
      if (!t) return;
      state.items.push({ id: uuid(), text: t, sphere: s, date: selectedDate, ts: Date.now() });
      inputs[s].value='';
      await doSaveAndRerender();
    });
    inputs[s].addEventListener('keydown', async (e)=>{
      if (e.key==='Enter'){
        e.preventDefault();
        const t = inputs[s].value.trim();
        if (!t) return;
        state.items.push({ id: uuid(), text: t, sphere: s, date: selectedDate, ts: Date.now() });
        inputs[s].value='';
        await doSaveAndRerender();
      }
    });
  }
  ['body','mind','meaning'].forEach(bindInput);

  /* ===== Telegram MainButton ===== */
  if (tg){
    tg.ready(); tg.expand(); applyTheme(); setHello();
    tg.onEvent('themeChanged', applyTheme);
    tg.MainButton.setParams({ text: '–î–æ–±–∞–≤–∏—Ç—å –ø–æ–±–µ–¥—É' });
    tg.MainButton.onClick(async ()=>{
      for (const s of ['body','mind','meaning']){
        const t = inputs[s].value.trim();
        if (t){
          state.items.push({ id: uuid(), text: t, sphere: s, date: selectedDate, ts: Date.now() });
          inputs[s].value='';
          await doSaveAndRerender();
          break;
        }
      }
    });
    tg.MainButton.show();
  }

  /* ===== Init ===== */
  (async ()=>{
    state = await loadState();
    if (!state.createdAt){ state.createdAt = todayISO(); }
    if (!state.scores){ state.scores = {body:0,mind:0,meaning:0}; }

    recomputeScores();
    await saveState(state);

    renderBars();
    renderDayTitle();
    renderDays();
    renderList();
    streakEl.textContent = calcStreak();
  })();
});
</script>
</body>
</html>

